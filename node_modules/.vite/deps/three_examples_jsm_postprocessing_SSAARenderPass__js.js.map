{
  "version": 3,
  "sources": ["../../three/examples/jsm/postprocessing/SSAARenderPass.js"],
  "sourcesContent": ["import {\r\n\tAdditiveBlending,\r\n\tColor,\r\n\tHalfFloatType,\r\n\tShaderMaterial,\r\n\tUniformsUtils,\r\n\tWebGLRenderTarget\r\n} from 'three';\r\nimport { Pass, FullScreenQuad } from './Pass.js';\r\nimport { CopyShader } from '../shaders/CopyShader.js';\r\n\r\n/**\r\n*\r\n* Supersample Anti-Aliasing Render Pass\r\n*\r\n* This manual approach to SSAA re-renders the scene ones for each sample with camera jitter and accumulates the results.\r\n*\r\n* References: https://en.wikipedia.org/wiki/Supersampling\r\n*\r\n*/\r\n\r\nclass SSAARenderPass extends Pass {\r\n\r\n\tconstructor( scene, camera, clearColor, clearAlpha ) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.scene = scene;\r\n\t\tthis.camera = camera;\r\n\r\n\t\tthis.sampleLevel = 4; // specified as n, where the number of samples is 2^n, so sampleLevel = 4, is 2^4 samples, 16.\r\n\t\tthis.unbiased = true;\r\n\r\n\t\tthis.stencilBuffer = false;\r\n\r\n\t\t// as we need to clear the buffer in this pass, clearColor must be set to something, defaults to black.\r\n\t\tthis.clearColor = ( clearColor !== undefined ) ? clearColor : 0x000000;\r\n\t\tthis.clearAlpha = ( clearAlpha !== undefined ) ? clearAlpha : 0;\r\n\t\tthis._oldClearColor = new Color();\r\n\r\n\t\tconst copyShader = CopyShader;\r\n\t\tthis.copyUniforms = UniformsUtils.clone( copyShader.uniforms );\r\n\r\n\t\tthis.copyMaterial = new ShaderMaterial(\t{\r\n\t\t\tuniforms: this.copyUniforms,\r\n\t\t\tvertexShader: copyShader.vertexShader,\r\n\t\t\tfragmentShader: copyShader.fragmentShader,\r\n\t\t\ttransparent: true,\r\n\t\t\tdepthTest: false,\r\n\t\t\tdepthWrite: false,\r\n\t\t\tpremultipliedAlpha: true,\r\n\t\t\tblending: AdditiveBlending\r\n\t\t} );\r\n\r\n\t\tthis.fsQuad = new FullScreenQuad( this.copyMaterial );\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tif ( this.sampleRenderTarget ) {\r\n\r\n\t\t\tthis.sampleRenderTarget.dispose();\r\n\t\t\tthis.sampleRenderTarget = null;\r\n\r\n\t\t}\r\n\r\n\t\tthis.copyMaterial.dispose();\r\n\r\n\t\tthis.fsQuad.dispose();\r\n\r\n\t}\r\n\r\n\tsetSize( width, height ) {\r\n\r\n\t\tif ( this.sampleRenderTarget )\tthis.sampleRenderTarget.setSize( width, height );\r\n\r\n\t}\r\n\r\n\trender( renderer, writeBuffer, readBuffer ) {\r\n\r\n\t\tif ( ! this.sampleRenderTarget ) {\r\n\r\n\t\t\tthis.sampleRenderTarget = new WebGLRenderTarget( readBuffer.width, readBuffer.height, { type: HalfFloatType, stencilBuffer: this.stencilBuffer } );\r\n\t\t\tthis.sampleRenderTarget.texture.name = 'SSAARenderPass.sample';\r\n\r\n\t\t}\r\n\r\n\t\tconst jitterOffsets = _JitterVectors[ Math.max( 0, Math.min( this.sampleLevel, 5 ) ) ];\r\n\r\n\t\tconst autoClear = renderer.autoClear;\r\n\t\trenderer.autoClear = false;\r\n\r\n\t\trenderer.getClearColor( this._oldClearColor );\r\n\t\tconst oldClearAlpha = renderer.getClearAlpha();\r\n\r\n\t\tconst baseSampleWeight = 1.0 / jitterOffsets.length;\r\n\t\tconst roundingRange = 1 / 32;\r\n\t\tthis.copyUniforms[ 'tDiffuse' ].value = this.sampleRenderTarget.texture;\r\n\r\n\t\tconst viewOffset = {\r\n\r\n\t\t\tfullWidth: readBuffer.width,\r\n\t\t\tfullHeight: readBuffer.height,\r\n\t\t\toffsetX: 0,\r\n\t\t\toffsetY: 0,\r\n\t\t\twidth: readBuffer.width,\r\n\t\t\theight: readBuffer.height\r\n\r\n\t\t};\r\n\r\n\t\tconst originalViewOffset = Object.assign( {}, this.camera.view );\r\n\r\n\t\tif ( originalViewOffset.enabled ) Object.assign( viewOffset, originalViewOffset );\r\n\r\n\t\t// render the scene multiple times, each slightly jitter offset from the last and accumulate the results.\r\n\t\tfor ( let i = 0; i < jitterOffsets.length; i ++ ) {\r\n\r\n\t\t\tconst jitterOffset = jitterOffsets[ i ];\r\n\r\n\t\t\tif ( this.camera.setViewOffset ) {\r\n\r\n\t\t\t\tthis.camera.setViewOffset(\r\n\r\n\t\t\t\t\tviewOffset.fullWidth, viewOffset.fullHeight,\r\n\r\n\t\t\t\t\tviewOffset.offsetX + jitterOffset[ 0 ] * 0.0625, viewOffset.offsetY + jitterOffset[ 1 ] * 0.0625, // 0.0625 = 1 / 16\r\n\r\n\t\t\t\t\tviewOffset.width, viewOffset.height\r\n\r\n\t\t\t\t);\r\n\r\n\t\t\t}\r\n\r\n\t\t\tlet sampleWeight = baseSampleWeight;\r\n\r\n\t\t\tif ( this.unbiased ) {\r\n\r\n\t\t\t\t// the theory is that equal weights for each sample lead to an accumulation of rounding errors.\r\n\t\t\t\t// The following equation varies the sampleWeight per sample so that it is uniformly distributed\r\n\t\t\t\t// across a range of values whose rounding errors cancel each other out.\r\n\r\n\t\t\t\tconst uniformCenteredDistribution = ( - 0.5 + ( i + 0.5 ) / jitterOffsets.length );\r\n\t\t\t\tsampleWeight += roundingRange * uniformCenteredDistribution;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.copyUniforms[ 'opacity' ].value = sampleWeight;\r\n\t\t\trenderer.setClearColor( this.clearColor, this.clearAlpha );\r\n\t\t\trenderer.setRenderTarget( this.sampleRenderTarget );\r\n\t\t\trenderer.clear();\r\n\t\t\trenderer.render( this.scene, this.camera );\r\n\r\n\t\t\trenderer.setRenderTarget( this.renderToScreen ? null : writeBuffer );\r\n\r\n\t\t\tif ( i === 0 ) {\r\n\r\n\t\t\t\trenderer.setClearColor( 0x000000, 0.0 );\r\n\t\t\t\trenderer.clear();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.fsQuad.render( renderer );\r\n\r\n\t\t}\r\n\r\n\t\tif ( this.camera.setViewOffset && originalViewOffset.enabled ) {\r\n\r\n\t\t\tthis.camera.setViewOffset(\r\n\r\n\t\t\t\toriginalViewOffset.fullWidth, originalViewOffset.fullHeight,\r\n\r\n\t\t\t\toriginalViewOffset.offsetX, originalViewOffset.offsetY,\r\n\r\n\t\t\t\toriginalViewOffset.width, originalViewOffset.height\r\n\r\n\t\t\t);\r\n\r\n\t\t} else if ( this.camera.clearViewOffset ) {\r\n\r\n\t\t\tthis.camera.clearViewOffset();\r\n\r\n\t\t}\r\n\r\n\t\trenderer.autoClear = autoClear;\r\n\t\trenderer.setClearColor( this._oldClearColor, oldClearAlpha );\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\n// These jitter vectors are specified in integers because it is easier.\r\n// I am assuming a [-8,8) integer grid, but it needs to be mapped onto [-0.5,0.5)\r\n// before being used, thus these integers need to be scaled by 1/16.\r\n//\r\n// Sample patterns reference: https://msdn.microsoft.com/en-us/library/windows/desktop/ff476218%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396\r\nconst _JitterVectors = [\r\n\t[\r\n\t\t[ 0, 0 ]\r\n\t],\r\n\t[\r\n\t\t[ 4, 4 ], [ - 4, - 4 ]\r\n\t],\r\n\t[\r\n\t\t[ - 2, - 6 ], [ 6, - 2 ], [ - 6, 2 ], [ 2, 6 ]\r\n\t],\r\n\t[\r\n\t\t[ 1, - 3 ], [ - 1, 3 ], [ 5, 1 ], [ - 3, - 5 ],\r\n\t\t[ - 5, 5 ], [ - 7, - 1 ], [ 3, 7 ], [ 7, - 7 ]\r\n\t],\r\n\t[\r\n\t\t[ 1, 1 ], [ - 1, - 3 ], [ - 3, 2 ], [ 4, - 1 ],\r\n\t\t[ - 5, - 2 ], [ 2, 5 ], [ 5, 3 ], [ 3, - 5 ],\r\n\t\t[ - 2, 6 ], [ 0, - 7 ], [ - 4, - 6 ], [ - 6, 4 ],\r\n\t\t[ - 8, 0 ], [ 7, - 4 ], [ 6, 7 ], [ - 7, - 8 ]\r\n\t],\r\n\t[\r\n\t\t[ - 4, - 7 ], [ - 7, - 5 ], [ - 3, - 5 ], [ - 5, - 4 ],\r\n\t\t[ - 1, - 4 ], [ - 2, - 2 ], [ - 6, - 1 ], [ - 4, 0 ],\r\n\t\t[ - 7, 1 ], [ - 1, 2 ], [ - 6, 3 ], [ - 3, 3 ],\r\n\t\t[ - 7, 6 ], [ - 3, 6 ], [ - 5, 7 ], [ - 1, 7 ],\r\n\t\t[ 5, - 7 ], [ 1, - 6 ], [ 6, - 5 ], [ 4, - 4 ],\r\n\t\t[ 2, - 3 ], [ 7, - 2 ], [ 1, - 1 ], [ 4, - 1 ],\r\n\t\t[ 2, 1 ], [ 6, 2 ], [ 0, 4 ], [ 4, 4 ],\r\n\t\t[ 2, 5 ], [ 7, 5 ], [ 5, 6 ], [ 3, 7 ]\r\n\t]\r\n];\r\n\r\nexport { SSAARenderPass };\r\n"],
  "mappings": "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",
  "names": []
}
